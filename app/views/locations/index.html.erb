<div id="locations">
  <login v-if="token == null"></login>
  <temperature v-else>Logged In</temperature>
</div>

<script type="text/x-template" id="temperature-template">
  <div>
    <h1>{{ temp }}</h1>
    <p>{{ location }}</p>
  </div>
</script>

<script type="text/x-template" id="login-template">
  <form>
    <input v-model="email" placeholder="Email">
    <input v-model="password" type="password" placeholder="Password">
    <button v-on:click="submit">Login</button>
  </form>
</script>

<script>
var state = {
  token: localStorage.getItem("token")
}

Vue.component("temperature", {
  template: "#temperature-template",
  data: function() {
    return {
      temp: null,
      location: null
    }
  },
  created: function() {
    this.fetchData()
  },
  methods: {
    fetchData: function() {
      Vue.http.headers.common['Authorization'] = "Bearer " + state.token
      this.$http.get("/api/v1/locations/1").then(response => {
        this.temp = response.body.data.attributes.current.temp
        this.location = response.body.data.attributes.name
      })
    }
  }
})

Vue.component("login", {
  template: "#login-template",
  data: function() {
    return {
      email: "",
      password: ""
    }
  },
  methods: {
    submit: function(event) {
      event.preventDefault()
      this.$http.post("/api/v1/auth", { auth: { email: this.email, password: this.password }}).then(response => {
        localStorage.setItem("token", response.body.token)
        state.token = response.body.token
      })
    }
  }
})

new Vue({
  el: "#locations",
  data: state
})
</script>
